{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","MarkoffControl","region","instanceid","self","prototype","main","on","e","preventDefault","option","saveSurveyResponse","console","log","remove","hasClass","question","closest","questionid","data","questiontitle","response","addClass","call","methodname","args","done","completed","find","html","message","delay","fadeOut","fail","reason","error","init","debug","first","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Provides the block_markoff/control module\r\n *\r\n * @package   block_markoff\r\n * @category  output\r\n * @copyright 2020 Veronica Bermegui, Michael Vangelovski\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module block_markoff/control\r\n */\r\n define(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the block controls.\r\n     */\r\n    function init(instanceid) {\r\n        Log.debug('block_markoff/control: initializing controls of the block_markoff block instance ' + instanceid);\r\n\r\n        var region = $('[data-region=\"block_markoff-instance-' + instanceid +'\"]').first();\r\n        \r\n        if (!region.length) {\r\n            Log.debug('block_markoff/control: wrapping region not found!');\r\n            return;\r\n        }\r\n\r\n        var control = new MarkoffControl(region, instanceid);\r\n        control.main();\r\n    }\r\n\r\n    // Constructor.\r\n    function MarkoffControl(region, instanceid) {\r\n        var self = this;       \r\n        self.region = region;\r\n        self.instanceid = instanceid;\r\n    }\r\n\r\n    MarkoffControl.prototype.main = function () {\r\n        var self = this;\r\n\r\n        // Handle answer click.\r\n        self.region.on('click', '.answer .option', function(e) {\r\n            e.preventDefault();\r\n            var option = $(this);\r\n            self.saveSurveyResponse(option);\r\n        });\r\n        \r\n        self.region.on('click', '.survey-exit', function(e){\r\n          e.preventDefault();\r\n          var option = $(this) ; // User opted out.\r\n          console.log(option);\r\n          self.saveSurveyResponse(option);\r\n          self.region.remove();\r\n            \r\n        });\r\n    }\r\n\r\n    MarkoffControl.prototype.saveSurveyResponse = function (option) {\r\n        var self = this;\r\n\r\n        // Check if already submiting.\r\n        if (self.region.hasClass('submitting')) {\r\n            return;\r\n        }\r\n        \r\n        \r\n\r\n        var question = option.closest('.question');\r\n        var questionid = question.data('id');\r\n        var questiontitle = question.data('title');\r\n        var response;\r\n        if (option.hasClass('survey-exit')){\r\n            response = '2-opted-out';\r\n        }else{\r\n             response = option.data('value');\r\n        }\r\n   \r\n        if (questionid == null || questiontitle == null || response == null) {\r\n            return;\r\n        }\r\n\r\n        self.region.addClass('submitting');\r\n        question.addClass('submitting');\r\n        option.addClass('submitting');\r\n\r\n        Ajax.call([{\r\n            methodname: 'block_markoff_save_survey_response',\r\n            args: {\r\n                questionid: questionid,\r\n                questiontitle: questiontitle,\r\n                response: response\r\n            },\r\n            done: function (response) {\r\n                if (response.completed) {\r\n                    self.region.find('.survey').html(response.message);\r\n                    self.region.delay(2000).fadeOut(400);\r\n                }\r\n            },\r\n            fail: function (reason) {\r\n                self.region.find('.survey').html('<h3>Error: Failed to save survey response.</h3>');\r\n                Log.error(reason);\r\n            }\r\n        }]);\r\n    }\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"controls.min.js"}