{"version":3,"file":"controls.min.js","sources":["../src/controls.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Provides the block_markoff/control module\r\n *\r\n * @package   block_markoff\r\n * @category  output\r\n * @copyright 2020 Veronica Bermegui, Michael Vangelovski\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module block_markoff/control\r\n */\r\n define(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the block controls.\r\n     */\r\n    function init(instanceid,isstudent) {\r\n        Log.debug('block_markoff/control: initializing controls of the block_markoff block instance ' + instanceid);\r\n\r\n        var region = $('[data-region=\"block_markoff-instance-' + instanceid + '\"]').first();\r\n\r\n        if (!region.length) {\r\n            Log.debug('block_markoff/control: wrapping region not found!');\r\n            return;\r\n        }\r\n\r\n        var control = new MarkoffControl(region, instanceid,isstudent);\r\n        control.main();\r\n    }\r\n\r\n    // Constructor.\r\n    function MarkoffControl(region, instanceid,isstudent) {\r\n        var self = this;\r\n        self.region = region;\r\n        self.instanceid = instanceid;\r\n        self.isstudent = isstudent;\r\n    }\r\n\r\n    MarkoffControl.prototype.main = function () {\r\n        var self = this;\r\n\r\n        // Add body class.\r\n        $('body').addClass('markoff-visible');\r\n\r\n        // Handle answer click.\r\n        self.region.on('click', '.answer .option', function(e) {\r\n            e.preventDefault();\r\n            var option = $(this);\r\n            self.saveSurveyResponse(option);\r\n        });\r\n\r\n        self.region.on('click', '.survey-exit', function(e){\r\n            e.preventDefault();\r\n            self.saveStaffOptOut();\r\n            self.region.remove();\r\n            $('body').removeClass('markoff-visible');\r\n        });\r\n\r\n        // Display Help Section to Student\r\n        if(self.isstudent == true){\r\n            self.region.find('.help').addClass('student');\r\n            self.region.find('#markoff-make-appointment').on('click', function(e) {\r\n                e.preventDefault();\r\n                console.log('Make appointment clicked');\r\n                window.location.href = this.href;\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n\r\n    MarkoffControl.prototype.saveStaffOptOut =  function(){\r\n        Ajax.call([{\r\n            methodname: 'block_markoff_save_staff_opt_out',\r\n            args: {},\r\n            done: function (response) {\r\n              Log.debug(response);\r\n            },\r\n            fail: function (reason) {\r\n              Log.error(reason);\r\n            }\r\n        }]);\r\n    }\r\n\r\n    MarkoffControl.prototype.saveSurveyResponse = function (option) {\r\n        var self = this;\r\n\r\n        // Check if already submiting.\r\n        if (self.region.hasClass('submitting')) {\r\n            return;\r\n        }\r\n\r\n        var question = option.closest('.question');\r\n        var questionid = question.data('id');\r\n        var questiontitle = question.data('title');\r\n        var response = option.data('value');\r\n\r\n        if (questionid == null || questiontitle == null || response == null) {\r\n            return;\r\n        }\r\n\r\n        self.region.addClass('submitting');\r\n        question.addClass('submitting');\r\n        option.addClass('submitting');\r\n\r\n        Ajax.call([{\r\n            methodname: 'block_markoff_save_survey_response',\r\n            args: {\r\n              questionid: questionid,\r\n              questiontitle: questiontitle,\r\n              response: response\r\n            },\r\n            done: function (response) {\r\n              if (response.completed) {\r\n                self.region.find('.survey').html(response.message);\r\n                self.region.delay(2000).fadeOut(400);\r\n              }\r\n              $('body').removeClass('markoff-visible');\r\n            },\r\n            fail: function (reason) {\r\n              self.region.find('.survey').html('<h3>Error: Failed to save survey response.</h3>');\r\n              Log.error(reason);\r\n            }\r\n        }]);\r\n    }\r\n\r\n    return {\r\n        init: init\r\n    };\r\n });"],"names":["define","$","Log","Ajax","MarkoffControl","region","instanceid","isstudent","this","prototype","main","self","addClass","on","e","preventDefault","option","saveSurveyResponse","saveStaffOptOut","remove","removeClass","find","console","log","window","location","href","call","methodname","args","done","response","debug","fail","reason","error","hasClass","question","closest","questionid","data","questiontitle","completed","html","message","delay","fadeOut","init","first","length"],"mappings":";;;;;;;;AA2BCA,gCAAO,CAAC,SAAU,WAAY,cAAc,SAAUC,EAAGC,IAAKC,eAqBlDC,eAAeC,OAAQC,WAAWC,WAC5BC,KACNH,OAASA,OADHG,KAENF,WAAaA,WAFPE,KAGND,UAAYA,iBAGrBH,eAAeK,UAAUC,KAAO,eACxBC,KAAOH,KAGXP,EAAE,QAAQW,SAAS,mBAGnBD,KAAKN,OAAOQ,GAAG,QAAS,mBAAmB,SAASC,GAChDA,EAAEC,qBACEC,OAASf,EAAEO,MACfG,KAAKM,mBAAmBD,WAG5BL,KAAKN,OAAOQ,GAAG,QAAS,gBAAgB,SAASC,GAC7CA,EAAEC,iBACFJ,KAAKO,kBACLP,KAAKN,OAAOc,SACZlB,EAAE,QAAQmB,YAAY,sBAIL,GAAlBT,KAAKJ,YACJI,KAAKN,OAAOgB,KAAK,SAAST,SAAS,WACnCD,KAAKN,OAAOgB,KAAK,6BAA6BR,GAAG,SAAS,SAASC,GAC/DA,EAAEC,iBACFO,QAAQC,IAAI,4BACZC,OAAOC,SAASC,KAAOlB,KAAKkB,UAOxCtB,eAAeK,UAAUS,gBAAmB,WACxCf,KAAKwB,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,GACNC,KAAM,SAAUC,UACd7B,IAAI8B,MAAMD,WAEZE,KAAM,SAAUC,QACdhC,IAAIiC,MAAMD,aAKpB9B,eAAeK,UAAUQ,mBAAqB,SAAUD,YAChDL,KAAOH,SAGPG,KAAKN,OAAO+B,SAAS,mBAIrBC,SAAWrB,OAAOsB,QAAQ,aAC1BC,WAAaF,SAASG,KAAK,MAC3BC,cAAgBJ,SAASG,KAAK,SAC9BT,SAAWf,OAAOwB,KAAK,SAET,MAAdD,YAAuC,MAAjBE,eAAqC,MAAZV,WAInDpB,KAAKN,OAAOO,SAAS,cACrByB,SAASzB,SAAS,cAClBI,OAAOJ,SAAS,cAEhBT,KAAKwB,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CACJU,WAAYA,WACZE,cAAeA,cACfV,SAAUA,UAEZD,KAAM,SAAUC,UACVA,SAASW,YACX/B,KAAKN,OAAOgB,KAAK,WAAWsB,KAAKZ,SAASa,SAC1CjC,KAAKN,OAAOwC,MAAM,KAAMC,QAAQ,MAElC7C,EAAE,QAAQmB,YAAY,oBAExBa,KAAM,SAAUC,QACdvB,KAAKN,OAAOgB,KAAK,WAAWsB,KAAK,mDACjCzC,IAAIiC,MAAMD,eAKb,CACHa,cA/GUzC,WAAWC,WACrBL,IAAI8B,MAAM,oFAAsF1B,gBAE5FD,OAASJ,EAAE,wCAA0CK,WAAa,MAAM0C,QAEvE3C,OAAO4C,OAKE,IAAI7C,eAAeC,OAAQC,WAAWC,WAC5CG,OALJR,IAAI8B,MAAM"}