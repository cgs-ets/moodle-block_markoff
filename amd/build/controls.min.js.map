{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","MarkoffControl","region","instanceid","isstudent","self","prototype","main","on","e","preventDefault","option","saveSurveyResponse","saveStaffOptOut","remove","find","addClass","call","methodname","args","done","response","debug","fail","reason","error","hasClass","question","closest","questionid","data","questiontitle","completed","html","message","delay","fadeOut","init","first","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_markoff/control module\n *\n * @package   block_markoff\n * @category  output\n * @copyright 2020 Veronica Bermegui, Michael Vangelovski\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_markoff/control\n */\n define(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n\n    /**\n     * Initializes the block controls.\n     */\n    function init(instanceid,isstudent) {\n        Log.debug('block_markoff/control: initializing controls of the block_markoff block instance ' + instanceid);\n\n        var region = $('[data-region=\"block_markoff-instance-' + instanceid + '\"]').first();\n\n        if (!region.length) {\n            Log.debug('block_markoff/control: wrapping region not found!');\n            return;\n        }\n\n        var control = new MarkoffControl(region, instanceid,isstudent);\n        control.main();\n    }\n\n    // Constructor.\n    function MarkoffControl(region, instanceid,isstudent) {\n        var self = this;\n        self.region = region;\n        self.instanceid = instanceid;\n        self.isstudent = isstudent;\n    }\n\n    MarkoffControl.prototype.main = function () {\n        var self = this;\n\n        // Handle answer click.\n        self.region.on('click', '.answer .option', function(e) {\n            e.preventDefault();\n            var option = $(this);\n            self.saveSurveyResponse(option);\n        });\n\n        self.region.on('click', '.survey-exit', function(e){\n            e.preventDefault();\n            self.saveStaffOptOut();\n            self.region.remove();\n        });\n        \n        // Display Help Section to Student\n        if(self.isstudent == true){\n            self.region.find('.help').addClass('student');\n        }\n        \n\n    }\n\n\n        MarkoffControl.prototype.saveStaffOptOut =  function(){\n\n            Ajax.call([{\n                methodname: 'block_markoff_save_staff_opt_out',\n                args: {\n                    },\n                done: function (response) {\n                     Log.debug(response);\n                },\n                fail: function (reason) {\n                    Log.error(reason);\n                }\n            }]);\n\n        }\n\n        MarkoffControl.prototype.saveSurveyResponse = function (option) {\n            var self = this;\n\n            // Check if already submiting.\n            if (self.region.hasClass('submitting')) {\n                return;\n            }\n\n            var question = option.closest('.question');\n            var questionid = question.data('id');\n            var questiontitle = question.data('title');\n            var  response = option.data('value');\n            \n            if (questionid == null || questiontitle == null || response == null) {\n                return;\n            }\n\n            self.region.addClass('submitting');\n            question.addClass('submitting');\n            option.addClass('submitting');\n\n            Ajax.call([{\n                methodname: 'block_markoff_save_survey_response',\n                args: {\n                    questionid: questionid,\n                    questiontitle: questiontitle,\n                    response: response\n                },\n                done: function (response) {\n                    if (response.completed) {\n                        self.region.find('.survey').html(response.message);\n                        self.region.delay(2000).fadeOut(400);\n                    }\n                },\n                fail: function (reason) {\n                    self.region.find('.survey').html('<h3>Error: Failed to save survey response.</h3>');\n                    Log.error(reason);\n                }\n            }]);\n        }\n\n        return {\n            init: init\n        };\n });"],"file":"controls.min.js"}