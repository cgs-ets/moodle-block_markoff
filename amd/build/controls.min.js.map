{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","MarkoffControl","region","instanceid","self","prototype","main","on","e","preventDefault","option","saveSurveyResponse","hasClass","question","closest","questionid","data","questiontitle","response","addClass","call","methodname","args","done","completed","find","html","message","delay","fadeOut","fail","reason","error","init","debug","first","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_markoff/control module\n *\n * @package   block_markoff\n * @category  output\n * @copyright 2020 Veronica Bermegui, Michael Vangelovski\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_markoff/control\n */\n define(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n\n    /**\n     * Initializes the block controls.\n     */\n    function init(instanceid) {\n        Log.debug('block_markoff/control: initializing controls of the block_markoff block instance ' + instanceid);\n\n        var region = $('[data-region=\"block_markoff-instance-' + instanceid +'\"]').first();\n        \n        if (!region.length) {\n            Log.debug('block_markoff/control: wrapping region not found!');\n            return;\n        }\n\n        var control = new MarkoffControl(region, instanceid);\n        control.main();\n    }\n\n    // Constructor.\n    function MarkoffControl(region, instanceid) {\n        var self = this;       \n        self.region = region;\n        self.instanceid = instanceid;\n    }\n\n    MarkoffControl.prototype.main = function () {\n        var self = this;\n\n        // Handle answer click.\n        self.region.on('click', '.answer .option', function(e) {\n            e.preventDefault();\n            var option = $(this);\n            self.saveSurveyResponse(option);\n        });\n    }\n\n    MarkoffControl.prototype.saveSurveyResponse = function (option) {\n        var self = this;\n\n        // Check if already submiting.\n        if (self.region.hasClass('submitting')) {\n            return;\n        }\n\n        var question = option.closest('.question');\n        var questionid = question.data('id');\n        var questiontitle = question.data('title');\n        var response = option.data('value');\n\n        if (questionid == null || questiontitle == null || response == null) {\n            return;\n        }\n\n        self.region.addClass('submitting');\n        question.addClass('submitting');\n        option.addClass('submitting');\n\n        Ajax.call([{\n            methodname: 'block_markoff_save_survey_response',\n            args: {\n                questionid: questionid,\n                questiontitle: questiontitle,\n                response: response\n            },\n            done: function (response) {\n                if (response.completed) {\n                    self.region.find('.survey').html(response.message);\n                    self.region.delay(2000).fadeOut(400);\n                }\n            },\n            fail: function (reason) {\n                self.region.find('.survey').html('<h3>Error: Failed to save survey response.</h3>');\n                Log.error(reason);\n            }\n        }]);\n    }\n\n    return {\n        init: init\n    };\n});"],"file":"controls.min.js"}