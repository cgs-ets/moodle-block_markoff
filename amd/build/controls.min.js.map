{"version":3,"file":"controls.min.js","sources":["../src/controls.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_markoff/control module\n *\n * @package   block_markoff\n * @category  output\n * @copyright 2020 Veronica Bermegui, Michael Vangelovski\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_markoff/control\n */\n define(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n\n    /**\n     * Initializes the block controls.\n     */\n    function init(instanceid,isstudent) {\n        Log.debug('block_markoff/control: initializing controls of the block_markoff block instance ' + instanceid);\n\n        var region = $('[data-region=\"block_markoff-instance-' + instanceid + '\"]').first();\n\n        if (!region.length) {\n            Log.debug('block_markoff/control: wrapping region not found!');\n            return;\n        }\n\n        var control = new MarkoffControl(region, instanceid,isstudent);\n        control.main();\n    }\n\n    // Constructor.\n    function MarkoffControl(region, instanceid,isstudent) {\n        var self = this;\n        self.region = region;\n        self.instanceid = instanceid;\n        self.isstudent = isstudent;\n    }\n\n    MarkoffControl.prototype.main = function () {\n        var self = this;\n\n        // Handle answer click.\n        self.region.on('click', '.answer .option', function(e) {\n            e.preventDefault();\n            var option = $(this);\n            self.saveSurveyResponse(option);\n        });\n\n        self.region.on('click', '.survey-exit', function(e){\n            e.preventDefault();\n            self.saveStaffOptOut();\n            self.region.remove();\n        });\n        \n        // Display Help Section to Student\n        if(self.isstudent == true){\n            self.region.find('.help').addClass('student');\n        }        \n\n    }\n\n\n    MarkoffControl.prototype.saveStaffOptOut =  function(){\n        Ajax.call([{\n            methodname: 'block_markoff_save_staff_opt_out',\n            args: {},\n            done: function (response) {\n              Log.debug(response);\n            },\n            fail: function (reason) {\n              Log.error(reason);\n            }\n        }]);\n    }\n\n    MarkoffControl.prototype.saveSurveyResponse = function (option) {\n        var self = this;\n\n        // Check if already submiting.\n        if (self.region.hasClass('submitting')) {\n            return;\n        }\n\n        var question = option.closest('.question');\n        var questionid = question.data('id');\n        var questiontitle = question.data('title');\n        var response = option.data('value');\n        \n        if (questionid == null || questiontitle == null || response == null) {\n            return;\n        }\n\n        self.region.addClass('submitting');\n        question.addClass('submitting');\n        option.addClass('submitting');\n\n        Ajax.call([{\n            methodname: 'block_markoff_save_survey_response',\n            args: {\n              questionid: questionid,\n              questiontitle: questiontitle,\n              response: response\n            },\n            done: function (response) {\n              if (response.completed) {\n                self.region.find('.survey').html(response.message);\n                self.region.delay(2000).fadeOut(400);\n                ('body').removeClass('markoff-visible');\n              }\n            },\n            fail: function (reason) {\n              self.region.find('.survey').html('<h3>Error: Failed to save survey response.</h3>');\n              Log.error(reason);\n            }\n        }]);\n    }\n\n    return {\n        init: init\n    };\n });"],"names":["define","$","Log","Ajax","MarkoffControl","region","instanceid","isstudent","this","prototype","main","self","on","e","preventDefault","option","saveSurveyResponse","saveStaffOptOut","remove","find","addClass","call","methodname","args","done","response","debug","fail","reason","error","hasClass","question","closest","questionid","data","questiontitle","completed","html","message","delay","fadeOut","removeClass","init","first","length"],"mappings":";;;;;;;;AA2BCA,gCAAO,CAAC,SAAU,WAAY,cAAc,SAAUC,EAAGC,IAAKC,eAqBlDC,eAAeC,OAAQC,WAAWC,WAC5BC,KACNH,OAASA,OADHG,KAENF,WAAaA,WAFPE,KAGND,UAAYA,iBAGrBH,eAAeK,UAAUC,KAAO,eACxBC,KAAOH,KAGXG,KAAKN,OAAOO,GAAG,QAAS,mBAAmB,SAASC,GAChDA,EAAEC,qBACEC,OAASd,EAAEO,MACfG,KAAKK,mBAAmBD,WAG5BJ,KAAKN,OAAOO,GAAG,QAAS,gBAAgB,SAASC,GAC7CA,EAAEC,iBACFH,KAAKM,kBACLN,KAAKN,OAAOa,YAIK,GAAlBP,KAAKJ,WACJI,KAAKN,OAAOc,KAAK,SAASC,SAAS,YAM3ChB,eAAeK,UAAUQ,gBAAmB,WACxCd,KAAKkB,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,GACNC,KAAM,SAAUC,UACdvB,IAAIwB,MAAMD,WAEZE,KAAM,SAAUC,QACd1B,IAAI2B,MAAMD,aAKpBxB,eAAeK,UAAUO,mBAAqB,SAAUD,YAChDJ,KAAOH,SAGPG,KAAKN,OAAOyB,SAAS,mBAIrBC,SAAWhB,OAAOiB,QAAQ,aAC1BC,WAAaF,SAASG,KAAK,MAC3BC,cAAgBJ,SAASG,KAAK,SAC9BT,SAAWV,OAAOmB,KAAK,SAET,MAAdD,YAAuC,MAAjBE,eAAqC,MAAZV,WAInDd,KAAKN,OAAOe,SAAS,cACrBW,SAASX,SAAS,cAClBL,OAAOK,SAAS,cAEhBjB,KAAKkB,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CACJU,WAAYA,WACZE,cAAeA,cACfV,SAAUA,UAEZD,KAAM,SAAUC,UACVA,SAASW,YACXzB,KAAKN,OAAOc,KAAK,WAAWkB,KAAKZ,SAASa,SAC1C3B,KAAKN,OAAOkC,MAAM,KAAMC,QAAQ,YACvBC,YAAY,qBAGzBd,KAAM,SAAUC,QACdjB,KAAKN,OAAOc,KAAK,WAAWkB,KAAK,mDACjCnC,IAAI2B,MAAMD,eAKb,CACHc,cAtGUpC,WAAWC,WACrBL,IAAIwB,MAAM,oFAAsFpB,gBAE5FD,OAASJ,EAAE,wCAA0CK,WAAa,MAAMqC,QAEvEtC,OAAOuC,OAKE,IAAIxC,eAAeC,OAAQC,WAAWC,WAC5CG,OALJR,IAAIwB,MAAM"}