define ("block_markoff/controls",["jquery","core/log","core/ajax"],function(a,b,c){'use strict';function d(a,b){var c=this;c.region=a;c.instanceid=b}d.prototype.main=function(){var b=this;b.region.on("click",".answer .option",function(c){c.preventDefault();var d=a(this);b.saveSurveyResponse(d)});b.region.on("click",".survey-exit",function(c){c.preventDefault();a(this);b.saveStaffOptOut();b.region.remove()})};d.prototype.saveStaffOptOut=function(){c.call([{methodname:"block_markoff_save_staff_opt_out",args:{},done:function done(a){b.debug(a)},fail:function fail(a){b.error(a)}}])};d.prototype.saveSurveyResponse=function(a){var d=this;if(d.region.hasClass("submitting")){return}var e=a.closest(".question"),f=e.data("id"),g=e.data("title"),h;if(a.hasClass("survey-exit")){h="2-opted-out"}else{h=a.data("value")}if(null==f||null==g||null==h){return}d.region.addClass("submitting");e.addClass("submitting");a.addClass("submitting");c.call([{methodname:"block_markoff_save_survey_response",args:{questionid:f,questiontitle:g,response:h},done:function done(a){if(a.completed){d.region.find(".survey").html(a.message);d.region.delay(2e3).fadeOut(400)}},fail:function fail(a){d.region.find(".survey").html("<h3>Error: Failed to save survey response.</h3>");b.error(a)}}])};return{init:function(c){b.debug("block_markoff/control: initializing controls of the block_markoff block instance "+c);var e=a("[data-region=\"block_markoff-instance-"+c+"\"]").first();if(!e.length){b.debug("block_markoff/control: wrapping region not found!");return}var f=new d(e,c);f.main()}}});
//# sourceMappingURL=controls.min.js.map
