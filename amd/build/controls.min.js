/**
 * Provides the block_markoff/control module
 *
 * @package   block_markoff
 * @category  output
 * @copyright 2020 Veronica Bermegui, Michael Vangelovski
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_markoff/controls",["jquery","core/log","core/ajax"],(function($,Log,Ajax){function MarkoffControl(region,instanceid,isstudent){this.region=region,this.instanceid=instanceid,this.isstudent=isstudent}return MarkoffControl.prototype.main=function(){var self=this;$("body").removeClass("markoff-visible"),self.region.on("click",".answer .option",(function(e){e.preventDefault();var option=$(this);self.saveSurveyResponse(option)})),self.region.on("click",".survey-exit",(function(e){e.preventDefault(),self.saveStaffOptOut(),self.region.remove()})),1==self.isstudent&&self.region.find(".help").addClass("student")},MarkoffControl.prototype.saveStaffOptOut=function(){Ajax.call([{methodname:"block_markoff_save_staff_opt_out",args:{},done:function(response){Log.debug(response)},fail:function(reason){Log.error(reason)}}])},MarkoffControl.prototype.saveSurveyResponse=function(option){var self=this;if(!self.region.hasClass("submitting")){var question=option.closest(".question"),questionid=question.data("id"),questiontitle=question.data("title"),response=option.data("value");null!=questionid&&null!=questiontitle&&null!=response&&(self.region.addClass("submitting"),question.addClass("submitting"),option.addClass("submitting"),Ajax.call([{methodname:"block_markoff_save_survey_response",args:{questionid:questionid,questiontitle:questiontitle,response:response},done:function(response){response.completed&&(self.region.find(".survey").html(response.message),self.region.delay(2e3).fadeOut(400),$("body").removeClass("markoff-visible"))},fail:function(reason){self.region.find(".survey").html("<h3>Error: Failed to save survey response.</h3>"),Log.error(reason)}}]))}},{init:function(instanceid,isstudent){Log.debug("block_markoff/control: initializing controls of the block_markoff block instance "+instanceid);var region=$('[data-region="block_markoff-instance-'+instanceid+'"]').first();region.length?new MarkoffControl(region,instanceid,isstudent).main():Log.debug("block_markoff/control: wrapping region not found!")}}}));

//# sourceMappingURL=controls.min.js.map