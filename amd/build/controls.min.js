define ("block_markoff/controls",["jquery","core/log","core/ajax"],function(a,b,c){'use strict';function d(a,b,c){var d=this;d.region=a;d.instanceid=b;d.isstudent=c}d.prototype.main=function(){var b=this;b.region.on("click",".answer .option",function(c){c.preventDefault();var d=a(this);b.saveSurveyResponse(d)});b.region.on("click",".survey-exit",function(a){a.preventDefault();b.saveStaffOptOut();b.region.remove()});if(!0==b.isstudent){b.region.find(".help").addClass("student")}};d.prototype.saveStaffOptOut=function(){c.call([{methodname:"block_markoff_save_staff_opt_out",args:{},done:function done(a){b.debug(a)},fail:function fail(a){b.error(a)}}])};d.prototype.saveSurveyResponse=function(a){var d=this;if(d.region.hasClass("submitting")){return}var e=a.closest(".question"),f=e.data("id"),g=e.data("title"),h=a.data("value");if(null==f||null==g||null==h){return}d.region.addClass("submitting");e.addClass("submitting");a.addClass("submitting");c.call([{methodname:"block_markoff_save_survey_response",args:{questionid:f,questiontitle:g,response:h},done:function done(a){if(a.completed){d.region.find(".survey").html(a.message);d.region.delay(2e3).fadeOut(400)}},fail:function fail(a){d.region.find(".survey").html("<h3>Error: Failed to save survey response.</h3>");b.error(a)}}])};return{init:function(c,e){b.debug("block_markoff/control: initializing controls of the block_markoff block instance "+c);var f=a("[data-region=\"block_markoff-instance-"+c+"\"]").first();if(!f.length){b.debug("block_markoff/control: wrapping region not found!");return}var g=new d(f,c,e);g.main()}}});
//# sourceMappingURL=controls.min.js.map
